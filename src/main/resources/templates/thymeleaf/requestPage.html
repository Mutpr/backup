<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">


    <title>요청 목록</title>

    <th:block layout:fragment="css">
        <link
                href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
                rel="stylesheet">
        <link href="/css/sb-admin-2.min.css" rel="stylesheet">
        <style>
            .tdContent:hover {
                background-color: #f5f6fb;
            }

            .tdHead {
                background-color: #f5f5f5;
            }
        </style>
    </th:block>

    <th:block layout:fragment="script">
        <script src="https://kit.fontawesome.com/24311b556d.js" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
                integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
                crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
                integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
                crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
                integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
                crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <script>

            $(document).ready(function () {
                // 페이지 로드 시 첫 페이지 데이터 로딩
                setTR(1);
                loadPageCount(1);
                // 페이지네이션 클릭 이벤트 처리
                $(document).on('click', '.pagination li', function (e) {
                    let option = $(this).attr('value');
                    console.log(option)
                    loadPageCount(option);
                    setTR(option);
                });
            });

            function loadPageCount(pageNo) {
                $.ajax({
                    url: 'pagination',
                    data: {"pageNo": pageNo},
                    success: function (success) {
                        console.log(success)
                        for(let i in success){
                            let data = success[i].DTO;
                            console.log(data)
                            let dataJson = JSON.parse(data);
                            let id = dataJson.id;

                        }
                        let totalPage = success[i].totalPage;
                        //console.log(id)
                        console.log(totalPage)
                        let pagination = document.querySelector('.pagination');
                        pagination.innerHTML = '';

                        let prevPage = document.createElement('li');
                        prevPage.classList.add('page-item');
                        prevPage.innerHTML = `<a class="page-link" href="#">&laquo;</a>`;
                        pagination.appendChild(prevPage);

                        if (totalPage === 1) {
                            pagination.remove();
                            console.log("nothing here")
                        } else {
                            for (let i = 1; i <= totalPage; i++) {

                                let pageItem = document.createElement('li');
                                pageItem.classList.add('page-item');
                                pageItem.setAttribute('value', i);
                                pageItem.innerHTML = `<a class="page-link">${i}</a>`;
                                pagination.appendChild(pageItem);
                            }
                            let nextPage = document.createElement('li');
                            nextPage.classList.add('page-item');
                            nextPage.innerHTML = `<a class="page-link">&raquo;</a>`;
                            pagination.appendChild(nextPage);
                        }
                    }
                })
            }

            function setTR(pageNo) {
                $.ajax({
                    url: 'pagination',
                    data: {"pageNo": pageNo},
                    success: function (data) {
                        console.log(data);
                        console.log(data.length);
                        let tbody = document.querySelector("tbody");
                        tbody.innerHTML = ''; // 기존의 내용을 초기화
                        for (let i in data) {
                            let DTO = JSON.parse(data[i].DTO);
                            let id = DTO.id;
                            let title = DTO.title;
                            let content = DTO.content;
                            let account = DTO.reqUsername;
                            let entry = DTO.entryDate;
                            let procDate = DTO.procDate;

                            let tr = document.createElement('tr');
                            tr.id = "request";
                            tr.setAttribute("onclick", "reqDetail(this)");

                            let tdId = document.createElement('td');
                            tdId.id = "requestNumber";
                            tdId.setAttribute("data-toggle", "modal");
                            tdId.setAttribute("data-target", "#exampleModal");
                            tdId.innerText = id;
                            tr.appendChild(tdId);

                            let tdTitle = document.createElement('td');
                            tdTitle.id = "requestTitle";
                            tdTitle.setAttribute("data-toggle", "modal");
                            tdTitle.setAttribute("data-target", "#exampleModal");
                            tdTitle.innerText = title;
                            tr.appendChild(tdTitle);

                            let tdContent = document.createElement('td');
                            tdContent.id = "requestContents";
                            tdContent.setAttribute("data-toggle", "modal");
                            tdContent.setAttribute("data-target", "#exampleModal");
                            tdContent.innerText = content;
                            tr.appendChild(tdContent);

                            let tdAccount = document.createElement('td');
                            tdAccount.id = "requestAccount";
                            tdAccount.setAttribute("data-toggle", "modal");
                            tdAccount.setAttribute("data-target", "#exampleModal");
                            tdAccount.innerText = account;
                            tr.appendChild(tdAccount);

                            let tdStatus = document.createElement('td');
                            tdStatus.id = "requestStatus";
                            tdStatus.setAttribute("data-toggle", "modal");
                            tdStatus.setAttribute("data-target", "#exampleModal");
                            tdStatus.innerText = "요청";
                            tr.appendChild(tdStatus);

                            let tdDate = document.createElement('td');
                            tdDate.id = "requestDate";
                            tdDate.setAttribute("data-toggle", "modal");
                            tdDate.setAttribute("data-target", "#exampleModal");
                            tdDate.innerText = entry;
                            tr.appendChild(tdDate);

                            let tdResponseDate = document.createElement('td');
                            tdResponseDate.id = "responseDate";
                            tdResponseDate.setAttribute("data-toggle", "modal");
                            tdResponseDate.setAttribute("data-target", "#exampleModal");
                            tdResponseDate.innerText = procDate;
                            tr.appendChild(tdResponseDate);

                            let tdDeletion = document.createElement('td');
                            tdDeletion.id = "requestDeletion";
                            let deletionIcon = document.createElement('i');
                            deletionIcon.classList.add('fa-solid', 'fa-trash-can');
                            deletionIcon.style.color = "#797a7c";
                            deletionIcon.style.cursor = "pointer";
                            deletionIcon.setAttribute("onclick", "removeAlert(this)");
                            tdDeletion.appendChild(deletionIcon);
                            tr.appendChild(tdDeletion);

                            tbody.appendChild(tr);
                        }
                    }
                })
            }

        </script>
    </th:block>
</head>
<body>
<div layout:fragment="content">
    <!-- Page Wrapper -->
    <div id="wrapper">
        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">
            <!-- Main Content -->
            <div id="content">
                <!-- Begin Page Content -->
                <div class="container-fluid">
                    <!-- Page Heading -->
                    <h1 class="h3 mb-2 text-gray-800">요청 목록</h1>
                    <p class="mb-4"></p>
                    <!-- DataTales Example -->
                    <div class="card shadow mb-4">
                        <!-- Topbar Search -->
                        <form action="/requestSearch" method="get" class="col input-group mt-3"
                              style="width: 40%; align-self: end;">
                            <input type="text" class="form-control m-0"
                                   placeholder="검색어를 입력해주세요"
                                   aria-label="Search" name="keyword">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="submit">
                                    <i class="fas fa-search fa-sm"></i>
                                </button>
                            </div>
                        </form>
                        <!--</div>-->
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="dataTable"
                                       style="text-align: center; font-size: 13px; color: black">
                                    <thead>
                                    <tr style=" width: -webkit-fill-available; font-weight: bold; background-color: #f5f6fb;">
                                        <th>요청</th>
                                        <th>제목</th>
                                        <th>내용</th>
                                        <th>요청 계정</th>
                                        <th>요청 상태</th>
                                        <th>요청 날짜</th>
                                        <th>응답 날짜</th>
                                        <th>비고</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr id = "request"  data-bs-toggle="modal" data-toggle="modal" data-target="#exampleModal">
                                        <td id="requestNumber">
                                        </td>
                                        <td id="requestTitle">
                                        </td>
                                        <td id="requestContents">
                                        </td>
                                        <td id="requestAccount">
                                        </td>
                                        <td id="requestStatus">
                                            요청
<!--                                        </td>-->
<!--                                        <td id="trueStatus" data-bs-toggle="modal"-->
<!--                                            data-toggle="modal" data-target="#exampleModal"-->
<!--                                        >-->
<!--                                            승인-->
<!--                                        </td>-->

                                        <td id="requestDate">
                                        </td>
                                        <td id="responseDate">
                                        </td>
                                        <td id="requestDeletion">
                                            <i class="fa-solid fa-trash-can" style="color: #797a7c; cursor: pointer;"
                                               onclick="removeAlert(this)"></i>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="d-flex justify-content-center">
                                <ul class="pagination">
                                    <li class="page-item">
                                        <a class="page-link" href="#" aria-label="Previous">
                                            <span aria-hidden="true">&laquo;</span>
                                        </a>
                                    </li>
                                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#" aria-label="Next">
                                            <span aria-hidden="true">&raquo;</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.container-fluid -->

                <!--요청정보 모달 시작-->
                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
                     aria-labelledby="exampleModalLabel"
                     aria-hidden="true">
                    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">요청상세정보</h5>
                            </div>
                            <div class="modal-body" id="modalDark" style="overflow-x: hidden">
                                <table class="table table-bordered align-middle"
                                       style="width: -webkit-fill-available; font-size: 15px">
                                    <tbody>
                                    <tr>
                                        <td class="tdHead">요청번호</td>
                                        <td colspan="3" class="tdContent" id="reqId"></td>
                                    </tr>
                                    <tr>
                                        <td class="col-2 tdHead">요청 구분</td>
                                        <td class="col-4 tdContent reqTitle"></td>
                                        <td class="col-2 tdHead">해당 아이디</td>
                                        <td class="col-4 tdContent" id="reqUsername"></td>
                                    </tr>
                                    <tr>
                                        <td class="col-2 tdHead">요청 이름
                                        </td>
                                        <td class="col-4 tdContent" id="reqNickname"></td>
                                        <td class="col-2 tdHead">요청 날짜
                                        </td>
                                        <td class="col-4 tdContent" id="reqEntryDate"></td>
                                    </tr>
                                    <tr>
                                        <td class="col-2 tdHead">요청 상태
                                        </td>
                                        <td class="col-4 tdContent" id="status">
                                        </td>
                                        <td class="col-2 tdHead">처리 결과</td>
                                        <td class="col-4 tdContent" id="statusNotNull"></td>
                                    </tr>
                                    <tr>
                                        <td class="col-2 tdHead">처리 계정
                                        </td>
                                        <td class="col-4 tdContent" id="reqProcUsername"></td>
                                        <td class="col-2 tdHead">처리 날짜</td>
                                        <td class="col-4 tdContent" id="reqProcDate"></td>
                                    </tr>
                                    <tr>
                                        <td class="tdHead">제목</td>
                                        <td colspan="3" class="tdContent reqTitle"></td>
                                    </tr>
                                    <tr>
                                        <td class="tdHead">내용</td>
                                        <td colspan="3" class="tdContent">
                                            <textarea class="form-control" id="reqContent" readonly>
                                            </textarea>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-success" id="approve" style="display: none">승인
                                </button>
                                <button type="button" class="btn btn-danger ml-2" id="refuse" style="display: none">거절
                                </button>
                                <button type="button" class="btn btn-secondary ml-2" data-dismiss="modal">닫기</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--유저정보 모달 끝-->
        </div>

    </div>
</div>
</body>
</html>